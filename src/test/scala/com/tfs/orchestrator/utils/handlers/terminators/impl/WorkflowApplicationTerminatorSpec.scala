package com.tfs.orchestrator.utils.handlers.terminators.impl

import net.liftweb.json.{DefaultFormats, parse}
import org.scalatest.FlatSpec

class WorkflowApplicationTerminatorSpec extends FlatSpec {
  behavior of "WorkflowApplicationTerminator"

  it should "return running yarn application id" in {
    val response = "{\"appName\":\"View_Dimensional_dish_2017-09-09T19:00+0000\",\"externalId\":null,\"conf\":\"<configuration>\\r\\n  <property>\\r\\n    <name>ucInstanceDate<\\/name>\\r\\n    <value>2017-09-09T19:00+0000<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>clientName<\\/name>\\r\\n    <value>dish<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>user.name<\\/name>\\r\\n    <value>oozie<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>oozie.coord.application.path<\\/name>\\r\\n    <value>hdfs:\\/\\/nameserviceQAHDP\\/user\\/oozie\\/dp2\\/coord\\/coord.xml<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>jobStartTime<\\/name>\\r\\n    <value>2017-09-09T19:00Z<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>mapreduce.job.user.name<\\/name>\\r\\n    <value>oozie<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>viewName<\\/name>\\r\\n    <value>View_Dimensional<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>hdfsConfigDir<\\/name>\\r\\n    <value>\\/etc\\/hadoop\\/conf<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>jobTracker<\\/name>\\r\\n    <value>datanode11.h2.dev.bigdata.sv2.247-inc.net:8050<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>ingestionType<\\/name>\\r\\n    <value>ALL<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>nameNode<\\/name>\\r\\n    <value>hdfs:\\/\\/nameserviceQAHDP\\/<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>oozie.libpath<\\/name>\\r\\n    <value>\\/user\\/oozie\\/dp2\\/lib<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>replayTask<\\/name>\\r\\n    <value>true<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>defaultPublish<\\/name>\\r\\n    <value>false<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>oozie.use.system.libpath<\\/name>\\r\\n    <value>true<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>oozie.coord.action.nominal_time<\\/name>\\r\\n    <value>1504983600000<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>waitForInputAvailability<\\/name>\\r\\n    <value>false<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>userName<\\/name>\\r\\n    <value>SUV<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>cronExpression<\\/name>\\r\\n    <value>0 * * * *<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>queueName<\\/name>\\r\\n    <value>LongRun<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>oozie.wf.application.path<\\/name>\\r\\n    <value>hdfs:\\/\\/nameserviceQAHDP\\/user\\/oozie\\/dp2\\/wf\\/workflow.xml<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>skipOutputCheck<\\/name>\\r\\n    <value>false<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>sleepTime<\\/name>\\r\\n    <value>120<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>hdfsPropertiesDir<\\/name>\\r\\n    <value>\\/user\\/oozie\\/dp2\\/properties\\/<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>workflowForCoord<\\/name>\\r\\n    <value>hdfs:\\/\\/nameserviceQAHDP\\/user\\/oozie\\/dp2\\/wf\\/workflow.xml<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>jobComplexity<\\/name>\\r\\n    <value>medium<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>jobEndTime<\\/name>\\r\\n    <value>2017-09-09T20:00Z<\\/value>\\r\\n  <\\/property>\\r\\n<\\/configuration>\",\"run\":0,\"acl\":null,\"appPath\":\"hdfs:\\/\\/nameserviceQAHDP\\/user\\/oozie\\/dp2\\/wf\\/workflow.xml\",\"parentId\":\"0002432-181210220144096-oozie-oozi-C@1\",\"lastModTime\":\"Mon, 17 Dec 2018 04:10:50 GMT\",\"consoleUrl\":\"http:\\/\\/oozie.qa.bigdata.sv2.247-inc.net:11000\\/oozie?job=0002433-181210220144096-oozie-oozi-W\",\"createdTime\":\"Mon, 17 Dec 2018 04:10:48 GMT\",\"startTime\":\"Mon, 17 Dec 2018 04:10:49 GMT\",\"toString\":\"Workflow id[0002433-181210220144096-oozie-oozi-W] status[RUNNING]\",\"id\":\"0002433-181210220144096-oozie-oozi-W\",\"endTime\":null,\"user\":\"oozie\",\"actions\":[{\"cred\":null,\"userRetryMax\":0,\"trackerUri\":\"-\",\"data\":null,\"errorMessage\":null,\"userRetryCount\":0,\"externalChildIDs\":null,\"externalId\":\"-\",\"errorCode\":null,\"conf\":\"\",\"type\":\":START:\",\"transition\":\"PreprocessTask\",\"retries\":0,\"consoleUrl\":\"-\",\"stats\":null,\"userRetryInterval\":10,\"name\":\":start:\",\"startTime\":\"Mon, 17 Dec 2018 04:10:49 GMT\",\"toString\":\"Action name[:start:] status[OK]\",\"id\":\"0002433-181210220144096-oozie-oozi-W@:start:\",\"endTime\":\"Mon, 17 Dec 2018 04:10:49 GMT\",\"externalStatus\":\"OK\",\"status\":\"OK\"},{\"cred\":null,\"userRetryMax\":0,\"trackerUri\":\"datanode11.h2.dev.bigdata.sv2.247-inc.net:8050\",\"data\":null,\"errorMessage\":null,\"userRetryCount\":0,\"externalChildIDs\":null,\"externalId\":\"job_1544439888269_31508\",\"errorCode\":null,\"conf\":\"<java xmlns=\\\"uri:oozie:workflow:0.1\\\">\\r\\n  <job-tracker>datanode11.h2.dev.bigdata.sv2.247-inc.net:8050<\\/job-tracker>\\r\\n  <name-node>hdfs:\\/\\/nameserviceQAHDP\\/<\\/name-node>\\r\\n  <configuration>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>oozie.launcher.mapreduce.task.classpath.user.precedence<\\/name>\\r\\n      <value>true<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>mapreduce.job.queuename<\\/name>\\r\\n      <value>LongRun<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>mapred.job.queue.name<\\/name>\\r\\n      <value>LongRun<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n  <\\/configuration>\\r\\n  <main-class>com.tfs.orchestrator.tasks.PreprocessingTask<\\/main-class>\\r\\n  <java-opts>-Dhadoop.config.dir=\\/etc\\/hadoop\\/conf -DisThreadContextMapInheritable=true -Duser.timezone=UTC -Dreplay.task=true -Dproperties.hdfs.dir=\\/user\\/oozie\\/dp2\\/properties\\/<\\/java-opts>\\r\\n  <arg>dish<\\/arg>\\r\\n  <arg>View_Dimensional<\\/arg>\\r\\n  <arg>2017-09-09T19:00+0000<\\/arg>\\r\\n  <arg>medium<\\/arg>\\r\\n  <file>hdfs:\\/\\/nameserviceQAHDP\\/\\/\\/user\\/oozie\\/dp2\\/properties\\/\\/log4j2.properties<\\/file>\\r\\n  <capture-output \\/>\\r\\n<\\/java>\",\"type\":\"java\",\"transition\":null,\"retries\":0,\"consoleUrl\":\"http:\\/\\/yarn01.h2.dev.bigdata.sv2.247-inc.net:8088\\/proxy\\/application_1544439888269_31508\\/\",\"stats\":null,\"userRetryInterval\":10,\"name\":\"PreprocessTask\",\"startTime\":\"Mon, 17 Dec 2018 04:10:49 GMT\",\"toString\":\"Action name[PreprocessTask] status[RUNNING]\",\"id\":\"0002433-181210220144096-oozie-oozi-W@PreprocessTask\",\"endTime\":null,\"externalStatus\":\"RUNNING\",\"status\":\"RUNNING\"}],\"status\":\"RUNNING\",\"group\":null}"
    val json = parse(response)
    implicit val formats = DefaultFormats
    val oozieResponse = json.extract[OozieResponse]
    val impl = new WorkflowApplicationTerminator
    val appId = impl.filterRunningApplications(oozieResponse)
    assert(appId.nonEmpty)
    assert(appId.get.equals("application_1544439888269_31508"))
  }

  it should "should return empty" in {
    val response = "{\"appName\":\"View_Dimensional_dish_2017-09-09T19:00+0000\",\"externalId\":null,\"conf\":\"<configuration>\\r\\n  <property>\\r\\n    <name>ucInstanceDate<\\/name>\\r\\n    <value>2017-09-09T19:00+0000<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>clientName<\\/name>\\r\\n    <value>dish<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>user.name<\\/name>\\r\\n    <value>oozie<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>oozie.coord.application.path<\\/name>\\r\\n    <value>hdfs:\\/\\/nameserviceQAHDP\\/user\\/oozie\\/dp2\\/coord\\/coord.xml<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>jobStartTime<\\/name>\\r\\n    <value>2017-09-09T19:00Z<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>mapreduce.job.user.name<\\/name>\\r\\n    <value>oozie<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>viewName<\\/name>\\r\\n    <value>View_Dimensional<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>hdfsConfigDir<\\/name>\\r\\n    <value>\\/etc\\/hadoop\\/conf<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>jobTracker<\\/name>\\r\\n    <value>datanode11.h2.dev.bigdata.sv2.247-inc.net:8050<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>ingestionType<\\/name>\\r\\n    <value>ALL<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>nameNode<\\/name>\\r\\n    <value>hdfs:\\/\\/nameserviceQAHDP\\/<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>oozie.libpath<\\/name>\\r\\n    <value>\\/user\\/oozie\\/dp2\\/lib<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>replayTask<\\/name>\\r\\n    <value>true<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>defaultPublish<\\/name>\\r\\n    <value>false<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>oozie.use.system.libpath<\\/name>\\r\\n    <value>true<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>oozie.coord.action.nominal_time<\\/name>\\r\\n    <value>1504983600000<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>waitForInputAvailability<\\/name>\\r\\n    <value>false<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>userName<\\/name>\\r\\n    <value>SUV<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>cronExpression<\\/name>\\r\\n    <value>0 * * * *<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>queueName<\\/name>\\r\\n    <value>LongRun<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>oozie.wf.application.path<\\/name>\\r\\n    <value>hdfs:\\/\\/nameserviceQAHDP\\/user\\/oozie\\/dp2\\/wf\\/workflow.xml<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>skipOutputCheck<\\/name>\\r\\n    <value>false<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>sleepTime<\\/name>\\r\\n    <value>120<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>hdfsPropertiesDir<\\/name>\\r\\n    <value>\\/user\\/oozie\\/dp2\\/properties\\/<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>workflowForCoord<\\/name>\\r\\n    <value>hdfs:\\/\\/nameserviceQAHDP\\/user\\/oozie\\/dp2\\/wf\\/workflow.xml<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>jobComplexity<\\/name>\\r\\n    <value>medium<\\/value>\\r\\n  <\\/property>\\r\\n  <property>\\r\\n    <name>jobEndTime<\\/name>\\r\\n    <value>2017-09-09T20:00Z<\\/value>\\r\\n  <\\/property>\\r\\n<\\/configuration>\",\"run\":0,\"acl\":null,\"appPath\":\"hdfs:\\/\\/nameserviceQAHDP\\/user\\/oozie\\/dp2\\/wf\\/workflow.xml\",\"parentId\":\"0002259-181210231741886-oozie-oozi-C@1\",\"lastModTime\":\"Mon, 17 Dec 2018 03:55:00 GMT\",\"consoleUrl\":\"http:\\/\\/oozie.qa.bigdata.sv2.247-inc.net:11000\\/oozie?job=0002260-181210231741886-oozie-oozi-W\",\"createdTime\":\"Mon, 17 Dec 2018 03:47:37 GMT\",\"startTime\":\"Mon, 17 Dec 2018 03:47:37 GMT\",\"toString\":\"Workflow id[0002260-181210231741886-oozie-oozi-W] status[SUCCEEDED]\",\"id\":\"0002260-181210231741886-oozie-oozi-W\",\"endTime\":\"Mon, 17 Dec 2018 03:55:00 GMT\",\"user\":\"oozie\",\"actions\":[{\"cred\":null,\"userRetryMax\":0,\"trackerUri\":\"-\",\"data\":null,\"errorMessage\":null,\"userRetryCount\":0,\"externalChildIDs\":null,\"externalId\":\"-\",\"errorCode\":null,\"conf\":\"\",\"type\":\":START:\",\"transition\":\"PreprocessTask\",\"retries\":0,\"consoleUrl\":\"-\",\"stats\":null,\"userRetryInterval\":10,\"name\":\":start:\",\"startTime\":\"Mon, 17 Dec 2018 03:47:37 GMT\",\"toString\":\"Action name[:start:] status[OK]\",\"id\":\"0002260-181210231741886-oozie-oozi-W@:start:\",\"endTime\":\"Mon, 17 Dec 2018 03:47:37 GMT\",\"externalStatus\":\"OK\",\"status\":\"OK\"},{\"cred\":null,\"userRetryMax\":0,\"trackerUri\":\"datanode11.h2.dev.bigdata.sv2.247-inc.net:8050\",\"data\":\"#\\n#Sun Dec 16 19:48:08 PST 2018\\nprocess_memory=-Xmx4g\\nJOB_START_EPOCH_TIME=1504983600000\\nUSER_NAME=yarn\\nSTART_EPOCH_TIME=1504983600000\\nCLIENT_NAME=dish\\nEND_EPOCH_TIME=1504987200000\\nnum-executors=3\\nQUEUE_NAME=LongRun\\nEND_TIME=201709092000\\nINPUT_AVAILABLE=false\\nJOB_EXECUTION_EXPRESSION=NOT_DEFINED\\nSTART_TIME=201709091900\\nVIEW_NAME=View_Dimensional\\n\",\"errorMessage\":null,\"userRetryCount\":0,\"externalChildIDs\":null,\"externalId\":\"job_1544439888269_31444\",\"errorCode\":null,\"conf\":\"<java xmlns=\\\"uri:oozie:workflow:0.1\\\">\\r\\n  <job-tracker>datanode11.h2.dev.bigdata.sv2.247-inc.net:8050<\\/job-tracker>\\r\\n  <name-node>hdfs:\\/\\/nameserviceQAHDP\\/<\\/name-node>\\r\\n  <configuration>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>oozie.launcher.mapreduce.task.classpath.user.precedence<\\/name>\\r\\n      <value>true<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>mapreduce.job.queuename<\\/name>\\r\\n      <value>LongRun<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>mapred.job.queue.name<\\/name>\\r\\n      <value>LongRun<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n  <\\/configuration>\\r\\n  <main-class>com.tfs.orchestrator.tasks.PreprocessingTask<\\/main-class>\\r\\n  <java-opts>-Dhadoop.config.dir=\\/etc\\/hadoop\\/conf -DisThreadContextMapInheritable=true -Duser.timezone=UTC -Dreplay.task=true -Dproperties.hdfs.dir=\\/user\\/oozie\\/dp2\\/properties\\/<\\/java-opts>\\r\\n  <arg>dish<\\/arg>\\r\\n  <arg>View_Dimensional<\\/arg>\\r\\n  <arg>2017-09-09T19:00+0000<\\/arg>\\r\\n  <arg>medium<\\/arg>\\r\\n  <file>hdfs:\\/\\/nameserviceQAHDP\\/\\/\\/user\\/oozie\\/dp2\\/properties\\/\\/log4j2.properties<\\/file>\\r\\n  <capture-output \\/>\\r\\n<\\/java>\",\"type\":\"java\",\"transition\":\"is_job_exe_exp_defined\",\"retries\":0,\"consoleUrl\":\"http:\\/\\/yarn01.h2.dev.bigdata.sv2.247-inc.net:8088\\/proxy\\/application_1544439888269_31444\\/\",\"stats\":null,\"userRetryInterval\":10,\"name\":\"PreprocessTask\",\"startTime\":\"Mon, 17 Dec 2018 03:47:37 GMT\",\"toString\":\"Action name[PreprocessTask] status[OK]\",\"id\":\"0002260-181210231741886-oozie-oozi-W@PreprocessTask\",\"endTime\":\"Mon, 17 Dec 2018 03:48:08 GMT\",\"externalStatus\":\"SUCCEEDED\",\"status\":\"OK\"},{\"cred\":null,\"userRetryMax\":0,\"trackerUri\":\"-\",\"data\":null,\"errorMessage\":null,\"userRetryCount\":0,\"externalChildIDs\":null,\"externalId\":\"-\",\"errorCode\":null,\"conf\":\"<switch xmlns=\\\"uri:oozie:workflow:0.1\\\">\\r\\n  <case to=\\\"input_availability\\\">true<\\/case>\\r\\n  <default to=\\\"job_execution_expression_validation\\\" \\/>\\r\\n<\\/switch>\",\"type\":\"switch\",\"transition\":\"input_availability\",\"retries\":0,\"consoleUrl\":\"-\",\"stats\":null,\"userRetryInterval\":10,\"name\":\"is_job_exe_exp_defined\",\"startTime\":\"Mon, 17 Dec 2018 03:48:08 GMT\",\"toString\":\"Action name[is_job_exe_exp_defined] status[OK]\",\"id\":\"0002260-181210231741886-oozie-oozi-W@is_job_exe_exp_defined\",\"endTime\":\"Mon, 17 Dec 2018 03:48:08 GMT\",\"externalStatus\":\"input_availability\",\"status\":\"OK\"},{\"cred\":null,\"userRetryMax\":0,\"trackerUri\":\"-\",\"data\":null,\"errorMessage\":null,\"userRetryCount\":0,\"externalChildIDs\":null,\"externalId\":\"-\",\"errorCode\":null,\"conf\":\"<switch xmlns=\\\"uri:oozie:workflow:0.1\\\">\\r\\n  <case to=\\\"ProcessingTask\\\">true<\\/case>\\r\\n  <default to=\\\"sleepTask\\\" \\/>\\r\\n<\\/switch>\",\"type\":\"switch\",\"transition\":\"ProcessingTask\",\"retries\":0,\"consoleUrl\":\"-\",\"stats\":null,\"userRetryInterval\":10,\"name\":\"input_availability\",\"startTime\":\"Mon, 17 Dec 2018 03:48:24 GMT\",\"toString\":\"Action name[input_availability] status[OK]\",\"id\":\"0002260-181210231741886-oozie-oozi-W@input_availability\",\"endTime\":\"Mon, 17 Dec 2018 03:48:24 GMT\",\"externalStatus\":\"ProcessingTask\",\"status\":\"OK\"},{\"cred\":null,\"userRetryMax\":0,\"trackerUri\":\"datanode11.h2.dev.bigdata.sv2.247-inc.net:8050\",\"data\":null,\"errorMessage\":null,\"userRetryCount\":0,\"externalChildIDs\":null,\"externalId\":\"job_1544439888269_31445\",\"errorCode\":null,\"conf\":\"<shell xmlns=\\\"uri:oozie:shell-action:0.1\\\">\\r\\n  <job-tracker>datanode11.h2.dev.bigdata.sv2.247-inc.net:8050<\\/job-tracker>\\r\\n  <name-node>hdfs:\\/\\/nameserviceQAHDP\\/<\\/name-node>\\r\\n  <configuration>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>mapreduce.job.queuename<\\/name>\\r\\n      <value>LongRun<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>yarn.nodemanager.pmem-check-enabled<\\/name>\\r\\n      <value>false<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>oozie.launcher.mapreduce.user.classpath.first<\\/name>\\r\\n      <value>true<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>mapred.job.queue.name<\\/name>\\r\\n      <value>LongRun<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n  <\\/configuration>\\r\\n  <exec>process_script.sh<\\/exec>\\r\\n  <argument>View_Dimensional<\\/argument>\\r\\n  <argument>dish<\\/argument>\\r\\n  <argument>201709091900<\\/argument>\\r\\n  <argument>201709092000<\\/argument>\\r\\n  <argument>LongRun<\\/argument>\\r\\n  <argument>\\\"\\\"<\\/argument>\\r\\n  <env-var>HADOOP_USER_NAME=oozie<\\/env-var>\\r\\n  <env-var>ID=0002260-181210231741886-oozie-oozi-W<\\/env-var>\\r\\n  <file>hdfs:\\/\\/nameserviceQAHDP\\/\\/\\/user\\/oozie\\/dp2\\/scripts\\/process_script.sh#process_script.sh<\\/file>\\r\\n<\\/shell>\",\"type\":\"shell\",\"transition\":\"PublishTask\",\"retries\":0,\"consoleUrl\":\"http:\\/\\/yarn01.h2.dev.bigdata.sv2.247-inc.net:8088\\/proxy\\/application_1544439888269_31445\\/\",\"stats\":null,\"userRetryInterval\":10,\"name\":\"ProcessingTask\",\"startTime\":\"Mon, 17 Dec 2018 03:48:39 GMT\",\"toString\":\"Action name[ProcessingTask] status[OK]\",\"id\":\"0002260-181210231741886-oozie-oozi-W@ProcessingTask\",\"endTime\":\"Mon, 17 Dec 2018 03:52:14 GMT\",\"externalStatus\":\"SUCCEEDED\",\"status\":\"OK\"},{\"cred\":null,\"userRetryMax\":0,\"trackerUri\":\"datanode11.h2.dev.bigdata.sv2.247-inc.net:8050\",\"data\":null,\"errorMessage\":null,\"userRetryCount\":0,\"externalChildIDs\":null,\"externalId\":\"job_1544439888269_31448\",\"errorCode\":null,\"conf\":\"<shell xmlns=\\\"uri:oozie:shell-action:0.1\\\">\\r\\n  <job-tracker>datanode11.h2.dev.bigdata.sv2.247-inc.net:8050<\\/job-tracker>\\r\\n  <name-node>hdfs:\\/\\/nameserviceQAHDP\\/<\\/name-node>\\r\\n  <configuration>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>mapreduce.job.queuename<\\/name>\\r\\n      <value>LongRun<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>oozie.launcher.mapreduce.user.classpath.first<\\/name>\\r\\n      <value>true<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>mapred.job.queue.name<\\/name>\\r\\n      <value>LongRun<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n  <\\/configuration>\\r\\n  <exec>ingest_script.sh<\\/exec>\\r\\n  <argument>dish<\\/argument>\\r\\n  <argument>View_Dimensional<\\/argument>\\r\\n  <argument>1504983600000<\\/argument>\\r\\n  <argument>1504987200000<\\/argument>\\r\\n  <argument>LongRun<\\/argument>\\r\\n  <argument>ALL<\\/argument>\\r\\n  <env-var>HADOOP_USER_NAME=oozie<\\/env-var>\\r\\n  <env-var>ID=0002260-181210231741886-oozie-oozi-W<\\/env-var>\\r\\n  <file>hdfs:\\/\\/nameserviceQAHDP\\/\\/\\/user\\/oozie\\/dp2\\/scripts\\/ingest_script.sh#ingest_script.sh<\\/file>\\r\\n<\\/shell>\",\"type\":\"shell\",\"transition\":\"SlaPublish1\",\"retries\":0,\"consoleUrl\":\"http:\\/\\/yarn01.h2.dev.bigdata.sv2.247-inc.net:8088\\/proxy\\/application_1544439888269_31448\\/\",\"stats\":null,\"userRetryInterval\":10,\"name\":\"PublishTask\",\"startTime\":\"Mon, 17 Dec 2018 03:52:14 GMT\",\"toString\":\"Action name[PublishTask] status[OK]\",\"id\":\"0002260-181210231741886-oozie-oozi-W@PublishTask\",\"endTime\":\"Mon, 17 Dec 2018 03:54:36 GMT\",\"externalStatus\":\"SUCCEEDED\",\"status\":\"OK\"},{\"cred\":null,\"userRetryMax\":0,\"trackerUri\":\"datanode11.h2.dev.bigdata.sv2.247-inc.net:8050\",\"data\":null,\"errorMessage\":null,\"userRetryCount\":0,\"externalChildIDs\":null,\"externalId\":\"job_1544439888269_31450\",\"errorCode\":null,\"conf\":\"<java xmlns=\\\"uri:oozie:workflow:0.1\\\">\\r\\n  <job-tracker>datanode11.h2.dev.bigdata.sv2.247-inc.net:8050<\\/job-tracker>\\r\\n  <name-node>hdfs:\\/\\/nameserviceQAHDP\\/<\\/name-node>\\r\\n  <configuration>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>mapreduce.job.queuename<\\/name>\\r\\n      <value>LongRun<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n    <property xmlns=\\\"\\\">\\r\\n      <name>mapred.job.queue.name<\\/name>\\r\\n      <value>LongRun<\\/value>\\r\\n      <source>programatically<\\/source>\\r\\n    <\\/property>\\r\\n  <\\/configuration>\\r\\n  <main-class>com.tfs.orchestrator.tasks.SlaPublishTask<\\/main-class>\\r\\n  <java-opts>-Dhadoop.config.dir=\\/etc\\/hadoop\\/conf -DisThreadContextMapInheritable=true -Duser.timezone=UTC -Dproperties.hdfs.dir=\\/user\\/oozie\\/dp2\\/properties\\/<\\/java-opts>\\r\\n  <arg>dish<\\/arg>\\r\\n  <arg>View_Dimensional<\\/arg>\\r\\n  <arg>2017-09-09T19:00+0000<\\/arg>\\r\\n  <arg>1504983600000<\\/arg>\\r\\n  <arg>1504987200000<\\/arg>\\r\\n  <file>hdfs:\\/\\/nameserviceQAHDP\\/\\/\\/user\\/oozie\\/dp2\\/properties\\/\\/log4j2.properties<\\/file>\\r\\n  <capture-output \\/>\\r\\n<\\/java>\",\"type\":\"java\",\"transition\":\"end\",\"retries\":0,\"consoleUrl\":\"http:\\/\\/yarn01.h2.dev.bigdata.sv2.247-inc.net:8088\\/proxy\\/application_1544439888269_31450\\/\",\"stats\":null,\"userRetryInterval\":10,\"name\":\"SlaPublish1\",\"startTime\":\"Mon, 17 Dec 2018 03:54:36 GMT\",\"toString\":\"Action name[SlaPublish1] status[OK]\",\"id\":\"0002260-181210231741886-oozie-oozi-W@SlaPublish1\",\"endTime\":\"Mon, 17 Dec 2018 03:55:00 GMT\",\"externalStatus\":\"SUCCEEDED\",\"status\":\"OK\"},{\"cred\":null,\"userRetryMax\":0,\"trackerUri\":\"-\",\"data\":null,\"errorMessage\":null,\"userRetryCount\":0,\"externalChildIDs\":null,\"externalId\":\"-\",\"errorCode\":null,\"conf\":\"\",\"type\":\":END:\",\"transition\":null,\"retries\":0,\"consoleUrl\":\"-\",\"stats\":null,\"userRetryInterval\":10,\"name\":\"end\",\"startTime\":\"Mon, 17 Dec 2018 03:55:00 GMT\",\"toString\":\"Action name[end] status[OK]\",\"id\":\"0002260-181210231741886-oozie-oozi-W@end\",\"endTime\":\"Mon, 17 Dec 2018 03:55:00 GMT\",\"externalStatus\":\"OK\",\"status\":\"OK\"}],\"status\":\"SUCCEEDED\",\"group\":null}"
    val json = parse(response)
    implicit val formats = DefaultFormats
    val oozieResponse = json.extract[OozieResponse]
    val impl = new WorkflowApplicationTerminator
    val appId = impl.filterRunningApplications(oozieResponse)
    assert(appId.isEmpty)
  }


}
